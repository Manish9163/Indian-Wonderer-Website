<!-- Tours Management with Real-time CRUD -->
<div class="container-fluid py-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="glass-card p-4">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2 class="gradient-text mb-2">
              <i class="fas fa-route me-2"></i>Tours Management
            </h2>
            <p class="text-muted mb-0">Manage your tour packages - Create, Edit, Delete</p>
          </div>
          <button class="btn btn-gradient" (click)="openAddModal()">
            <i class="fas fa-plus me-2"></i>Add New Tour
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="glass-card stat-card p-4">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="text-muted mb-1">Total Tours</p>
            <h3 class="mb-0">{{ stats.totalTours }}</h3>
          </div>
          <div class="stat-icon bg-primary">
            <i class="fas fa-route"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="glass-card stat-card p-4">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="text-muted mb-1">Active Tours</p>
            <h3 class="mb-0">{{ stats.activeTours }}</h3>
          </div>
          <div class="stat-icon bg-success">
            <i class="fas fa-check-circle"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="glass-card stat-card p-4">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="text-muted mb-1">Total Bookings</p>
            <h3 class="mb-0">{{ stats.totalBookings }}</h3>
          </div>
          <div class="stat-icon bg-warning">
            <i class="fas fa-calendar-check"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="glass-card stat-card p-4">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="text-muted mb-1">Avg Rating</p>
            <h3 class="mb-0">{{ stats.avgRating }}<i class="fas fa-star text-warning ms-2"></i></h3>
          </div>
          <div class="stat-icon bg-info">
            <i class="fas fa-star"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search and Filter -->
  <div class="row mb-4">
    <div class="col-md-8">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input 
          type="text" 
          class="form-control" 
          placeholder="Search tours by title or destination..."
          [(ngModel)]="searchTerm"
          (input)="filterTours()">
      </div>
    </div>
    <div class="col-md-4">
      <select class="form-select" [(ngModel)]="selectedCategory" (change)="filterTours()">
        <option value="all">All Categories</option>
        <option value="adventure">Adventure</option>
        <option value="cultural">Cultural</option>
        <option value="wildlife">Wildlife</option>
        <option value="spiritual">Spiritual</option>
        <option value="beach">Beach</option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading tours...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-circle me-2"></i>{{ errorMessage }}
    <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadTours()">
      <i class="fas fa-redo me-1"></i>Retry
    </button>
  </div>

  <!-- Tours Table -->
  <div *ngIf="!isLoading && !errorMessage" class="row">
    <div class="col-12">
      <div class="glass-card">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Destination</th>
                <th>Duration</th>
                <th>Price</th>
                <th>Category</th>
                <th>Bookings</th>
                <th>Rating</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let tour of filteredTours; let i = index" [class.table-success]="tour.is_active">
                <td><strong class="text-primary">#{{ i + 1 }}</strong></td>
                <td>
                  <strong>{{ tour.title }}</strong>
                  <br>
                  <small class="text-muted">{{ tour.description?.substring(0, 50) }}...</small>
                </td>
                <td>
                  <i class="fas fa-map-marker-alt text-danger me-1"></i>
                  {{ tour.destination }}
                </td>
                <td>
                  <span class="badge bg-info">{{ tour.duration_days }} days</span>
                </td>
                <td>
                  <strong class="text-success">₹{{ tour.price }}</strong>
                </td>
                <td>
                  <span class="badge bg-secondary">{{ tour.category }}</span>
                </td>
                <td>
                  <span class="badge" [class.bg-primary]="tour.booking_count === 0" [class.bg-warning]="tour.booking_count > 0">
                    {{ tour.booking_count || 0 }}
                    <i *ngIf="tour.booking_count > 0" class="fas fa-lock ms-1" title="Cannot delete - has bookings"></i>
                  </span>
                </td>
                <td>
                  <span class="text-warning">
                    <i class="fas fa-star"></i> {{ tour.avg_rating || 0 }}
                  </span>
                </td>
                <td>
                  <span class="badge" [class.bg-success]="tour.is_active" [class.bg-secondary]="!tour.is_active">
                    {{ tour.is_active ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td>
                  <div class="btn-group" role="group">
                    <button class="btn btn-sm btn-outline-primary" (click)="openEditModal(tour)" title="Edit">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-info" (click)="viewTour(tour)" title="View Details">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button 
                      class="btn btn-sm btn-outline-danger" 
                      (click)="confirmDelete(tour)" 
                      [title]="tour.booking_count > 0 ? 'Delete (will prompt to deactivate instead)' : 'Delete'">
                      <i class="fas" [class.fa-trash]="tour.booking_count === 0" [class.fa-ban]="tour.booking_count > 0"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredTours.length === 0">
                <td colspan="10" class="text-center py-4">
                  <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                  <p class="text-muted">No tours found</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Tour Modal -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content glass-card">
      <div class="modal-header">
        <h5 class="modal-title gradient-text">
          <i class="fas" [class.fa-plus]="!editingTour" [class.fa-edit]="editingTour"></i>
          {{ editingTour ? 'Edit Tour' : 'Add New Tour' }}
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form #tourFormElement="ngForm">
          <div class="row">
            <div class="col-md-8 mb-3">
              <label class="form-label">Tour Title <span class="text-danger">*</span></label>
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="tourForm.title" 
                name="title"
                placeholder="e.g., Golden Triangle Tour"
                required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Status</label>
              <select class="form-select" [(ngModel)]="tourForm.is_active" name="status">
                <option [value]="1">Active</option>
                <option [value]="0">Inactive</option>
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Description <span class="text-danger">*</span></label>
            <textarea 
              class="form-control" 
              rows="4" 
              [(ngModel)]="tourForm.description"
              name="description"
              placeholder="Detailed description of the tour..."
              required></textarea>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Destination <span class="text-danger">*</span></label>
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="tourForm.destination"
                name="destination"
                placeholder="e.g., Delhi, Agra, Jaipur"
                required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Category</label>
              <select class="form-select" [(ngModel)]="tourForm.category" name="category">
                <option value="adventure">Adventure</option>
                <option value="cultural">Cultural</option>
                <option value="wildlife">Wildlife</option>
                <option value="spiritual">Spiritual</option>
                <option value="beach">Beach</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">Price (₹) <span class="text-danger">*</span></label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="tourForm.price"
                name="price"
                placeholder="15000"
                required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Duration (Days) <span class="text-danger">*</span></label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="tourForm.duration_days"
                name="duration"
                placeholder="7"
                required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Difficulty Level</label>
              <select class="form-select" [(ngModel)]="tourForm.difficulty_level" name="difficulty">
                <option value="easy">Easy</option>
                <option value="moderate">Moderate</option>
                <option value="challenging">Challenging</option>
              </select>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          <i class="fas fa-times me-1"></i>Cancel
        </button>
        <button 
          type="button" 
          class="btn btn-gradient" 
          (click)="saveTour()"
          [disabled]="isSaving">
          <span *ngIf="!isSaving">
            <i class="fas" [class.fa-save]="!editingTour" [class.fa-check]="editingTour"></i>
            {{ editingTour ? 'Update Tour' : 'Create Tour' }}
          </span>
          <span *ngIf="isSaving">
            <i class="fas fa-spinner fa-spin me-1"></i>Saving...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop fade" [class.show]="showModal" *ngIf="showModal"></div>

<style>
.glass-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(15px);
  border-radius: 20px;
  padding: 1.5rem;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(102, 126, 234, 0.1);
}

.gradient-text {
  background: linear-gradient(45deg, #667eea, #764ba2);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 700;
}

.btn-gradient {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 10px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.btn-gradient:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.stat-card {
  transition: transform 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
}

.stat-icon {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.5rem;
}

.search-box {
  position: relative;
}

.search-box i {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: #667eea;
}

.search-box input {
  padding-left: 45px;
  border-radius: 10px;
  border: 2px solid rgba(102, 126, 234, 0.2);
}

.search-box input:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.table th {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.85rem;
  padding: 1rem;
}

.table tbody tr {
  transition: all 0.3s ease;
}

.table tbody tr:hover {
  background: rgba(102, 126, 234, 0.05);
  transform: scale(1.01);
}

.modal.show {
  background: rgba(0, 0, 0, 0.5);
}

.modal-content {
  border: none;
}
</style>
