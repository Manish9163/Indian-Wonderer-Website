    <div class="payments-dashboard">
      <!-- Enhanced Payment H            <div class="payment-metric">{{ 'â‚¹' + (paymentStats.pendingPayments | number) }}</div>
            <div class="payment-label">Pending Payments</div>
            <div class="payment-change negative">
              <i class="fas fa-arrow-down"></i>
              {{paymentStats.pendingGrowth}}% vs last month
            </div>-->
      <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-gradient-header rounded">
        <div>
          <h4 class="mb-1">ðŸ’³ Payment Management Center</h4>
          <small class="text-light">Comprehensive payment processing and analytics</small>
        </div>
        <div class="d-flex gap-2">
          <select class="form-select form-select-sm payment-filter" [(ngModel)]="selectedFilter" (change)="applyFilter()" style="width: auto;">
            <option value="all">All Payments</option>
            <option value="completed">Completed</option>
            <option value="pending">Pending</option>
            <option value="failed">Failed</option>
            <option value="refunded">Refunded</option>
          </select>
          <button class="btn btn-light btn-sm" (click)="generateReport()">
            <i class="fas fa-chart-bar"></i> Generate Report
          </button>
          <button class="btn btn-light btn-sm" (click)="exportPayments()">
            <i class="fas fa-download"></i> Export
          </button>
        </div>
      </div>

      <!-- Enhanced Payment Statistics Cards -->
      <div class="row g-4 mb-4">
        <div class="col-md-3">
          <div class="payment-stats-card gradient-success fade-in-up" (click)="onRevenueCardClick()">
            <div class="payment-icon">
              <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="payment-metric">{{ 'â‚¹' + (paymentStats.totalRevenue | number) }}</div>
            <div class="payment-label">Total Revenue</div>
            <div class="payment-change positive">
              <i class="fas fa-arrow-up"></i>
              +{{paymentStats.revenueGrowth}}% this month
            </div>
            <div class="payment-subtitle">Across all payment gateways</div>
            <div class="payment-progress">
              <div class="progress-bar success" [style.width]="'85%'"></div>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="payment-stats-card gradient-primary fade-in-up" (click)="onTransactionsCardClick()">
            <div class="payment-icon">
              <i class="fas fa-credit-card"></i>
            </div>
            <div class="payment-metric">{{paymentStats.totalTransactions | number}}</div>
            <div class="payment-label">Total Transactions</div>
            <div class="payment-change positive">
              <i class="fas fa-arrow-up"></i>
              +{{paymentStats.transactionGrowth}}% this month
            </div>
            <div class="payment-subtitle">Successfully processed</div>
            <div class="payment-progress">
              <div class="progress-bar success" [style.width]="'92%'"></div>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="payment-stats-card gradient-warning fade-in-up" (click)="onPendingCardClick()">
            <div class="payment-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="payment-metric">{{ 'â‚¹' + (paymentStats.pendingPayments | number) }}</div>
            <div class="payment-label">Pending Payments</div>
            <div class="payment-change negative">
              <i class="fas fa-arrow-down"></i>
              {{paymentStats.pendingGrowth}}% this month
            </div>
            <div class="payment-subtitle">Awaiting processing</div>
            <div class="payment-progress">
              <div class="progress-bar warning" [style.width]="'35%'"></div>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="payment-stats-card gradient-danger fade-in-up" (click)="onFailedCardClick()">
            <div class="payment-icon">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="payment-metric">{{paymentStats.failedPayments}}</div>
            <div class="payment-label">Failed Payments</div>
            <div class="payment-change positive">
              <i class="fas fa-arrow-down"></i>
              {{paymentStats.failureGrowth}}% this month
            </div>
            <div class="payment-subtitle">Declined or errors</div>
            <div class="payment-progress">
              <div class="progress-bar danger" [style.width]="'12%'"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Refund Statistics Cards -->
      <div class="row g-4 mb-4">
        <div class="col-md-3">
          <div class="payment-stats-card gradient-info fade-in-up">
            <div class="payment-icon">
              <i class="fas fa-undo"></i>
            </div>
            <div class="payment-metric">{{paymentStats.pendingRefunds}}</div>
            <div class="payment-label">Pending Refunds</div>
            <div class="payment-subtitle text-warning">
              <i class="fas fa-exclamation-circle"></i> Requires Action
            </div>
            <div class="payment-subtitle">â‚¹{{paymentStats.pendingRefundAmount | number}} to process</div>
            <button class="btn btn-sm btn-outline-light mt-2" (click)="scrollToPendingRefunds()">
              <i class="fas fa-arrow-down"></i> View List
            </button>
          </div>
        </div>

        <div class="col-md-3">
          <div class="payment-stats-card gradient-secondary fade-in-up">
            <div class="payment-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="payment-metric">{{paymentStats.completedRefunds}}</div>
            <div class="payment-label">Completed Refunds</div>
            <div class="payment-subtitle">â‚¹{{paymentStats.completedRefundAmount | number}} refunded</div>
            <div class="payment-progress">
              <div class="progress-bar info" [style.width]="'100%'"></div>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="payment-stats-card gradient-success fade-in-up">
            <div class="payment-icon">
              <i class="fas fa-gift"></i>
            </div>
            <div class="payment-metric">{{paymentStats.giftCardsIssued}}</div>
            <div class="payment-label">Gift Cards Issued</div>
            <div class="payment-subtitle">â‚¹{{paymentStats.giftCardAmount | number}} in credits</div>
            <div class="payment-subtitle text-success">
              <i class="fas fa-info-circle"></i> 10% bonus included
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="payment-stats-card gradient-dark fade-in-up">
            <div class="payment-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="payment-metric">â‚¹{{paymentStats.netRevenue | number}}</div>
            <div class="payment-label">Net Revenue</div>
            <div class="payment-subtitle">After refunds deduction</div>
            <div class="payment-subtitle text-muted">
              <small>Gross: â‚¹{{paymentStats.totalRevenue | number}}</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Gateway Status Panel -->
      <div class="payment-gateway-panel mb-4 fade-in-up">
        <div class="panel-header">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-1"><i class="fas fa-globe"></i> Payment Gateway Status</h5>
              <small>Real-time monitoring of payment processors</small>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-light btn-sm" (click)="refreshGatewayStatus()">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
              <button class="btn btn-light btn-sm" (click)="toggleMonitoring()">
                <i class="fas fa-play" *ngIf="!monitoringActive"></i>
                <i class="fas fa-pause" *ngIf="monitoringActive"></i>
                {{monitoringActive ? 'Stop' : 'Start'}} Monitor
              </button>
            </div>
          </div>
        </div>
        
        <div class="panel-body">
          <div class="row">
            <div class="col-md-3" *ngFor="let gateway of paymentGateways">
              <div class="gateway-status" [ngClass]="gateway.status" (click)="configureGateway(gateway.name)">
                <div class="text-center">
                  <div class="gateway-icon">
                    <i [class]="gateway.icon"></i>
                  </div>
                  <div class="gateway-name">{{gateway.name}}</div>
                  <div class="gateway-metric">{{ 'â‚¹' + (gateway.revenue | number) }}</div>
                  <div class="gateway-status-text">{{gateway.status.toUpperCase()}}</div>
                  <div class="gateway-uptime">Uptime: {{gateway.uptime}}</div>
                  <div class="gateway-uptime">Response: {{gateway.responseTime}}</div>
                  <div class="mt-2">
                    <button class="btn btn-sm" 
                            [ngClass]="gateway.status === 'active' ? 'btn-warning' : 'btn-success'"
                            (click)="toggleGateway(gateway.name); $event.stopPropagation()">
                      {{gateway.status === 'active' ? 'Disable' : 'Enable'}}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Payments Table -->
      <div class="card-modern mb-4 fade-in-up">
        <div class="panel-header">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-1"><i class="fas fa-list"></i> Recent Transactions</h5>
              <small>Latest payment activities and transactions</small>
            </div>
            <div class="d-flex gap-2">
              <select class="form-select form-select-sm payment-filter" [(ngModel)]="selectedPaymentGateway" (change)="applyGatewayFilter()" style="width: auto;">
                <option value="all">All Gateways</option>
                <option value="Stripe">Stripe</option>
                <option value="PayPal">PayPal</option>
                <option value="Razorpay">Razorpay</option>
                <option value="Square">Square</option>
              </select>
              <select class="form-select form-select-sm payment-filter" [(ngModel)]="selectedDateRange" (change)="applyDateRange()" style="width: auto;">
                <option value="today">Today</option>
                <option value="this-week">This Week</option>
                <option value="this-month">This Month</option>
                <option value="last-month">Last Month</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="panel-body">
          <div class="table-responsive">
            <table class="table table-hover payment-table">
              <thead>
                <tr>
                  <th>Transaction ID</th>
                  <th>Customer</th>
                  <th>Amount</th>
                  <th>Gateway</th>
                  <th>Status</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="payments.length === 0">
                  <td colspan="7" class="text-center py-4">
                    <div class="alert alert-info mb-0">
                      <i class="fas fa-info-circle"></i>
                      <strong>No payments to display.</strong>
                      <br>
                      <small>Total payments loaded from API: {{allPayments.length}}</small>
                      <br>
                      <small *ngIf="allPayments.length === 0">Check browser console for errors or ensure payments exist in the database.</small>
                    </div>
                  </td>
                </tr>
                <tr *ngFor="let payment of payments">
                  <td>
                    <span class="fw-bold">{{payment.id}}</span>
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                        {{payment.customerName.charAt(0)}}
                      </div>
                      {{payment.customerName}}
                    </div>
                  </td>
                  <td>
                    <span class="fw-bold">{{ 'â‚¹' + payment.amount }}</span>
                    <small class="text-muted d-block">INR</small>
                  </td>
                  <td>
                    <span class="badge bg-info">{{payment.gateway}}</span>
                  </td>
                  <td>
                    <span class="badge" 
                          [ngClass]="{
                            'bg-success': payment.status === 'completed',
                            'bg-warning': payment.status === 'pending',
                            'bg-danger': payment.status === 'failed',
                            'bg-secondary': payment.status === 'refunded'
                          }">
                      {{payment.status | titlecase}}
                    </span>
                  </td>
                  <td>{{payment.date | date:'short'}}</td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <button class="btn btn-info" (click)="viewPaymentDetails(payment.id)" title="View Details">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="btn btn-success" (click)="downloadReceipt(payment.id)" title="Download Receipt">
                        <i class="fas fa-download"></i>
                      </button>
                      <button class="btn btn-warning" 
                              (click)="processRefund(payment.id)" 
                              [disabled]="payment.status !== 'completed'"
                              title="Process Refund">
                        <i class="fas fa-undo"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Pending Refunds Section -->
      <div class="card-modern fade-in-up mb-4" id="pendingRefundsSection" *ngIf="pendingRefundsList.length > 0">
        <div class="panel-header bg-warning">
          <h5 class="mb-0">
            <i class="fas fa-exclamation-triangle"></i> Pending Refunds - Requires Action
            <span class="badge bg-light text-dark ms-2">{{pendingRefundsList.length}}</span>
          </h5>
        </div>
        <div class="panel-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead>
                <tr>
                  <th>Booking Ref</th>
                  <th>Customer</th>
                  <th>Tour</th>
                  <th>Refund Amount</th>
                  <th>Method</th>
                  <th>Initiated</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let refund of pendingRefundsList">
                  <td>
                    <span class="fw-bold font-monospace">{{refund.booking_reference}}</span>
                  </td>
                  <td>
                    <div>{{refund.first_name}} {{refund.last_name}}</div>
                    <small class="text-muted">{{refund.email}}</small>
                  </td>
                  <td>{{refund.tour_name}}</td>
                  <td>
                    <span class="fw-bold text-warning">â‚¹{{refund.refund_amount | number}}</span>
                  </td>
                  <td>
                    <span class="badge bg-info">{{refund.refund_method}}</span>
                  </td>
                  <td>
                    <small>{{refund.initiated_at | date:'short'}}</small>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <button class="btn btn-success" (click)="processRefund(refund)" title="Process Refund">
                        <i class="fas fa-check"></i> Process
                      </button>
                      <button class="btn btn-info" (click)="viewRefundDetails(refund)" title="View Details">
                        <i class="fas fa-eye"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Live Transaction Monitor -->
      <div class="card-modern fade-in-up" *ngIf="monitoringActive && liveTransactions.length > 0">
        <div class="panel-header">
          <h5 class="mb-0"><i class="fas fa-broadcast-tower pulse"></i> Live Transaction Monitor</h5>
        </div>
        <div class="panel-body">
          <div class="live-transactions">
            <div class="transaction-item" *ngFor="let transaction of liveTransactions">
              <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
                <div>
                  <strong>{{transaction.customer}}</strong>
                  <span class="text-muted ms-2">{{ 'â‚¹' + transaction.amount }}</span>
                </div>
                <div class="text-end">
                  <span class="badge bg-{{transaction.status === 'completed' ? 'success' : transaction.status === 'pending' ? 'warning' : 'info'}}">
                    {{transaction.status}}
                  </span>
                  <small class="text-muted d-block">{{transaction.gateway}}</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>